# 영속성 전이 CASCADE / 고아 객체

## 영속성 전이
### 특정 엔티티를 영속상태로 만들 때 연관된 엔티티도 함께 영속상태로 만들고 싶다면?
* 영속성전이 CASCADE 속성을 이용하자.
	* `cascade=CascadeType.PERSIST` : 함께 영속화
	* `cascade=CascadeType.REMOVE` : 함께 삭제
	* `cascade=CascadeType.ALL` : 전체 적용
	* `MERGE`, `REFRESH`, `DETACH` 도 있다.
* 영속성 전이는 연관관계를 매핑하는 것과는 아무 관련이 없다
* 엔티티를 영속화할 때 연관된 엔티티도 함께 영속화하는 편리함만을 제공

---
## 고아 객체
* 부모 엔티티와 연관관계가 끊어진 자식 엔티티를 말한다.
* 부모 엔티티의 자식 엔티티 컬렉션에서 자식 엔티티를 제거하면?
	* ex) `parent.getChildList().remove(0);` 인덱스 0의 자식 엔티티 제거
		* 자식 엔티티는 부모 엔티티와의 연관관계가 끊어졌다.

### 고아 객체를 자동으로 삭제 해주는 기능
* `orphanRemoval = true` 를 이용한다.
* 연관관계가 끊어지면 자동으로 엔티티 삭제한다.
* `CascadeType.REMOVE` **처럼 동작**

### 주의!
* 참조가 제거된 엔티티는 다른 곳에서 참조하지 않는 고아 객체로 보고 삭제하는 기능
* 다른 곳에서도 이를 참조한다면 예기치 못한 문제가 발생한다!!
* 꼭 참조하는 곳이 하나일 때 사용해야한다!
* `OneTo-` 만 사용 가능하다.

---
## 영속성 전이 + 고아 객체
- `CascadeType.All` + `orpahnRemovel=ture`
* 해당 옵션을 모두 활성화 하면 부모 엔티티를 통해 자식의 생명주기를 관리할 수 있다.
* 스스로 생명주기를 관리하는 엔티티는 `EntityManager.persist()`, `EntityManager.remove()` 를 통해 영속화, 제거되고, 자식 엔티티는 부모의 생명주기에 맞춰 영속화, 제거된다.



#JPA/영속성 전이 CASCADE#
#JPA/고아 객체#
---

해당 내용은 김영한님의 강의를 듣고 정리한 내용입니다.