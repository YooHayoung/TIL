# 영속성 컨텍스트

## 영속성 컨텍스트란?
* JPA를 이해하는데 가장 중요한 용어로 `엔티티를 영구 저장하는 환경`을 말한다.
* 논리적인 개념
* `EntityManager`를 통해 영속성 컨텍스트에 접근
* `J2SE` 환경에서는 EntityManager와 영속성 컨텍스트가 **1:1** 임
* `J2EE`, `Spring Framework` 같은 `Container 환경`에서는 EntityManager와 영속성 컨텍스트가 **N:1** 임

## Entity의 생명주기
* 비영속 : 영속성 컨텍스트와 **전혀 관계가 없는 새로운** 상태
* 영속 : **영속성 컨텍스트에 관리**되는 상태
* 준영속 : 영속성 컨텐스트에 **저장되었다가 분리**된 상태
* 삭제 : **삭제**된 상태

## 영속성 컨텍스트의 이점
* `1차 cache`
	* Entity를 영속화하거나 DB에 저장된 Entity를 불러오면 1차 캐시에 일단 저장한다.
	* DB에 검색을 할 때, **1차 캐시에서 먼저 확인** 후 존재하는 Entity는 Query를 날리지 않고 가져온다.
	* **1차 캐시에 없다면** DB Server에 Query를 날려서 가져온다.
* `동일성(identity) 보장`
	* 1차 캐시로 **반복 가능한 읽기(REPEATABLE READ)** 등급의 트랜잭션 격리 수준을 DB가 아닌 Application 차원에서 제공한다.
	* 1차 캐시에서 가져온 Entity는 **동일한 Entity임을 보장** 하는 것이다. ( == 비교 true )
* `트랜잭션을 지원하는 쓰기 지연`
	* EntityManager.persist(member) <- 영속화 시점에 DB에 SQL을 보내는 것이 아니다.
	* 1차 캐시에 저장하였다가 **commit 시점에 SQL을 전송**하여 DB에 저장한다.
* `Dirty Checking`
	* **트랜잭션 내**에서 영속 상태의 Entity를 수정한다.
	* **트랜잭션 커밋 시점**에 1차 캐시에서 Entity의 스냅샷과 비교하여 스냅샷과 다르면 update Query를 날린다.
* `Lazy Loading`(지연 로딩)
	* Entity를 DB에서 가져올 때 연관된 Entity 조회를 미룬다. -> Query 낭비 방지.



#JPA/영속성컨텍스트

---

해당 내용은 김영한님의 강의를 듣고 정리한 내용입니다.