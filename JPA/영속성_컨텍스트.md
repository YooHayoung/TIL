# 영속성 컨텍스트

## 영속성 컨텍스트란?
- JPA를 이해하는데 가장 중요한 용어다.
- 엔티티를 영구 저장하는 환경이라는 뜻
- 논리적인 개념
- 엔티티 매니저를 통해 영속성 컨텍스트에 접근한다.
- J2SE 환경에서는 EntityManager와 영속성 컨텍스트가 1:1 임
- J2EE, Spring Framework 같은 Container 환경에서는 EntityManager와 영속성 컨텍스트가 N:1 이다.

<br>

## Entity의 생명주기
- 비영속 <br> 영속성 컨텍스트와 전혀 관계가 없는 새로운 상태
- 영속 <br> 영속성 컨텍스트에 관리되는 상태
- 준영속 <br> 영속성 컨텐스트에 저장되었다가 분리된 상태
- 삭제 <br> 삭제된 상태

<br>

## 그럼 영속성 컨텍스트를 통하면 얻는게 뭔데?
- 1차 캐시
  - Entity를 영속화하거나 DB에 저장된 Entity를 불러오면 1차 캐시에 일단 저장한다. 
  - DB에 검색을 할 때, 1차 캐시에서 먼저 확인 후 존재하는 Entity는 Query를 날리지 않고 가져온다.
  - 1차 캐시에 없다면 그 때 DB Server에 Query를 날려서 가져온다.
- 동일성(identity) 보장
  - 1차 캐시로 반복 가능한 읽기(REPEATABLE READ) 등급의 트랜잭션 격리 수준을 DB가 아닌 Application 차원에서 제공한다.
  - 1차 캐시에서 가져온 Entity는 동일한 Entity임을 보장 하는 것이다. ( == 비교 true )
- 트랜잭션을 지원하는 쓰기 지연
  - EntityManager.persist(member) <- 영속화 시점에 DB에 SQL을 보내는 것이 아니다.
  - 1차 캐시에 저장하였다가 commit 시점에 SQL을 전송하여 DB에 저장한다.
- Dirty Checking
  - 트랜잭션 내에서 영속 상태의 Entity를 수정한다.
  - 트랜잭션 커밋 시점에 1차 캐시에서 Entity의 스냅샷과 비교한다.
  - 스냅샷과 다르면 update Query를 날린다.
- Lazy Loading

<br>









<br><br><br><br>

---

해당 내용은 김영한님의 강의를 듣고 정리한 내용입니다.