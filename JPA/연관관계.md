# 연관관계

## 연관관계 매핑
- 객체를 테이블에 맞추어 데이터 중심으로 모델링하면, 협력 관계를 만들 수 없다.
- 테이블은 외래키로 조인을 사용하여 연관된 테이블을 찾는다.
- 객체는 참조를 사용해서 연관된 객체를 찾는다.
- 객체를 테이블에 맞추어 모델링하면 참조가 아닌 외래키 식별자를 다루어 해당 식별자로 객체를 다시 조회하게 된다.
- 이건 객체지향스럽지 않다...

### 그래서 어떻게 해결하는데?
- 객체지향 모델링을 하자.
- 테이블의 외래키를 객체의 참조와 매핑하는 것이다.
- 이를 연관관계라고 한다.
- 참조를 통해 객체 그래프 탐색 가능

<br>

## 단방향 연관관계
- 한 방향으로만 객체 그래프 탐색할 수 있는 연관관계이다.
- 한쪽 객체에 참조를 두고 다른쪽은 두지 않는다.

<br>

## 양방향 연관관계
- 양방향으로 객체 그래프를 탐색할 수 있다.
- 양쪽 객체 둘 다 참조를 둔다.

### 그럼 외래키는 어디서 관리하나..?
- 테이블은 외래키 하나로 두 테이블의 연관관계를 관리한다.
- 객체는 외래키를 참조로 사용한다.
- 양방향 연관관계는 양쪽 다 참조가 있다.
- 연관관계의 주인을 설정하여 기준을 잡아주어야 한다!!

<br>

## 연관관계의 주인
- 객체의 양방향 관계는 사실 서로 다른 단방향 관계 2개다.
- 2개의 단방향 중 하나를 연관관계의 주인으로 지정하여 외래키를 관리하도록 한다.
- 다음 규칙을 갖는다.
  - 객체의 두 관계 중 하나를 연관관계의 주인으로 지정한다.
  - 연관관계의 주인만이 외래키를 관리한다. (등록, 수정)
  - 주인이 아닌쪽은 읽기만 가능하다.
  - 주인이 아니면 mappedBy 속성을 사용.
  - 주인은 mappedBy 사용 안한다.
- 누구를 주인으로 하나?
  - 외래키가 있는 곳을 주인으로 정하자. (1:* 에서 *쪽에 외래키)

<br>

## 양방향 매핑시 주의할 점
- 순수 객체 상태를 고려하여 항상! 양쪽에 값을 설정하자.
- 연관관계 편의 메소드를 생성하여 실수를 줄이도록 하자.
- 양방향 매핑시 무한 루프를 조심하자.

<br>



















<br><br><br><br>

---

해당 내용은 김영한님의 강의를 듣고 정리한 내용입니다.